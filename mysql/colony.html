<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据库集群 | YiYun</title>
    <meta name="description" content=" ">
    <link rel="icon" href="/avatar.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.c9cc6c8f.css" as="style"><link rel="preload" href="/assets/js/app.0d7d7ae6.js" as="script"><link rel="preload" href="/assets/js/36.997b8f65.js" as="script"><link rel="prefetch" href="/assets/js/10.36bdd46c.js"><link rel="prefetch" href="/assets/js/11.805402a7.js"><link rel="prefetch" href="/assets/js/12.2ed4cd75.js"><link rel="prefetch" href="/assets/js/13.3349958e.js"><link rel="prefetch" href="/assets/js/14.c6c47497.js"><link rel="prefetch" href="/assets/js/15.134142b4.js"><link rel="prefetch" href="/assets/js/16.038fc9f1.js"><link rel="prefetch" href="/assets/js/17.4ccef42c.js"><link rel="prefetch" href="/assets/js/18.d030362d.js"><link rel="prefetch" href="/assets/js/19.7f0791d9.js"><link rel="prefetch" href="/assets/js/2.3390981d.js"><link rel="prefetch" href="/assets/js/20.cc7fb248.js"><link rel="prefetch" href="/assets/js/21.6ee932a6.js"><link rel="prefetch" href="/assets/js/22.2b8d8a8a.js"><link rel="prefetch" href="/assets/js/23.9c608850.js"><link rel="prefetch" href="/assets/js/24.558b6b1d.js"><link rel="prefetch" href="/assets/js/25.b1030a09.js"><link rel="prefetch" href="/assets/js/26.0d23b209.js"><link rel="prefetch" href="/assets/js/27.119ae21a.js"><link rel="prefetch" href="/assets/js/28.6ec1bb46.js"><link rel="prefetch" href="/assets/js/29.f43fe30c.js"><link rel="prefetch" href="/assets/js/3.2a4456d6.js"><link rel="prefetch" href="/assets/js/30.617e1cfe.js"><link rel="prefetch" href="/assets/js/31.df2b930a.js"><link rel="prefetch" href="/assets/js/32.eb8eaa98.js"><link rel="prefetch" href="/assets/js/33.31fa76b6.js"><link rel="prefetch" href="/assets/js/34.d799d18c.js"><link rel="prefetch" href="/assets/js/35.7c00cacf.js"><link rel="prefetch" href="/assets/js/37.a07e133f.js"><link rel="prefetch" href="/assets/js/38.c11cda55.js"><link rel="prefetch" href="/assets/js/39.36c10e35.js"><link rel="prefetch" href="/assets/js/4.a77b3239.js"><link rel="prefetch" href="/assets/js/40.dacefd46.js"><link rel="prefetch" href="/assets/js/41.eedc39ce.js"><link rel="prefetch" href="/assets/js/42.c4159c95.js"><link rel="prefetch" href="/assets/js/43.384d799d.js"><link rel="prefetch" href="/assets/js/44.7240b248.js"><link rel="prefetch" href="/assets/js/45.df4da440.js"><link rel="prefetch" href="/assets/js/46.75dcc367.js"><link rel="prefetch" href="/assets/js/47.0fa12dfb.js"><link rel="prefetch" href="/assets/js/48.7227b331.js"><link rel="prefetch" href="/assets/js/49.24afa714.js"><link rel="prefetch" href="/assets/js/5.47c2eb99.js"><link rel="prefetch" href="/assets/js/50.691cd7d7.js"><link rel="prefetch" href="/assets/js/51.cd946b9e.js"><link rel="prefetch" href="/assets/js/52.8fb375b8.js"><link rel="prefetch" href="/assets/js/53.b122a8f6.js"><link rel="prefetch" href="/assets/js/54.8148cbb6.js"><link rel="prefetch" href="/assets/js/55.c5cdcaba.js"><link rel="prefetch" href="/assets/js/56.1672e4d8.js"><link rel="prefetch" href="/assets/js/57.28e43843.js"><link rel="prefetch" href="/assets/js/58.36a15c52.js"><link rel="prefetch" href="/assets/js/59.194be484.js"><link rel="prefetch" href="/assets/js/6.e72eb0d5.js"><link rel="prefetch" href="/assets/js/60.1d18f9a9.js"><link rel="prefetch" href="/assets/js/61.d49357b8.js"><link rel="prefetch" href="/assets/js/62.b2980720.js"><link rel="prefetch" href="/assets/js/63.3fb71192.js"><link rel="prefetch" href="/assets/js/64.0ba95369.js"><link rel="prefetch" href="/assets/js/7.0c20b0bd.js"><link rel="prefetch" href="/assets/js/8.4cdc2a77.js"><link rel="prefetch" href="/assets/js/9.ffa3c532.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c9cc6c8f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YiYun</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/swoft/basic.html" class="nav-link">Swoft</a></div><div class="nav-item"><a href="/yii/basic.html" class="nav-link">Yii2.0</a></div> <a href="https://github.com/jianhaihao/jianhaihao.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/swoft/basic.html" class="nav-link">Swoft</a></div><div class="nav-item"><a href="/yii/basic.html" class="nav-link">Yii2.0</a></div> <a href="https://github.com/jianhaihao/jianhaihao.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Linux进阶</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ECS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Mysql</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/mysql/basic.html" class="sidebar-link">MySql 基础知识</a></li><li><a href="/mysql/foreign-key.html" class="sidebar-link">外键设置</a></li><li><a href="/mysql/colony.html" class="active sidebar-link">数据库集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql/colony.html#单节点数据库弊端" class="sidebar-link">单节点数据库弊端</a></li><li class="sidebar-sub-header"><a href="/mysql/colony.html#常见mysql集群方案" class="sidebar-link">常见Mysql集群方案</a></li><li class="sidebar-sub-header"><a href="/mysql/colony.html#创建集群" class="sidebar-link">创建集群</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Mac</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ThinkPHP5</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Yii2.0</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Swoole</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Swoft基础</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Swoft进阶</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>MicroService</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Markdown</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>分布式服务架构</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Web安全</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="数据库集群"><a href="#数据库集群" aria-hidden="true" class="header-anchor">#</a> 数据库集群</h1> <h2 id="单节点数据库弊端"><a href="#单节点数据库弊端" aria-hidden="true" class="header-anchor">#</a> 单节点数据库弊端</h2> <blockquote><ul><li>大型互联网程序用户群体庞大，架构必须要特殊设计</li> <li>无法满足性能上的要求</li> <li>没有冗余设计，无法满足高可用</li></ul></blockquote> <h2 id="常见mysql集群方案"><a href="#常见mysql集群方案" aria-hidden="true" class="header-anchor">#</a> 常见Mysql集群方案</h2> <p><img src="/mysql-jq.jpg" alt="/mysql-jq.jpg"> <img src="/mysql-jq-1.jpg" alt="/mysql-jq-1.jpg"> <img src="/mysql-jq-2.jpg" alt="/mysql-jq-2.jpg"> <img src="/mysql-jq-3.jpg" alt="/mysql-jq-3.jpg"> <img src="/mysql-jq-4.jpg" alt="/mysql-jq-4.jpg"></p> <h2 id="创建集群"><a href="#创建集群" aria-hidden="true" class="header-anchor">#</a> 创建集群</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>
<span class="token comment"># 拉取 pxc 镜像</span>
docker pull percona/percona-xtradb-cluster

<span class="token comment"># 查看已安装的镜像</span>
docker images

<span class="token comment">#######################分割线##################################</span>

<span class="token comment"># 修改镜像名称（名称太长，不方便使用，选择性操作）</span>
docker tag percona/percona-xtradb-cluster pxc
<span class="token comment"># 删除旧的镜像</span>
docker rmi percona/percona-xtradb-cluster
<span class="token comment"># 查看已安装的镜像</span>
docker images

<span class="token comment">#######################分割线##################################</span>

<span class="token comment">#（出于安全考虑，需要给pxc集群实例创建docker内部网络）</span>
<span class="token comment"># docker虚拟机自带的网段地址为：172.17.0.XXX</span>

<span class="token comment"># 创建内部网段</span>
docker network create net1
<span class="token comment"># 查看内部网段</span>
docker network inspect net1   <span class="token comment"># network可省略</span>
<span class="token comment"># 删除内部网段</span>
docker network <span class="token function">rm</span> net1

<span class="token comment"># 创建指定网段</span>
docker network create --subnet<span class="token operator">=</span>172.18.0.0/24 net1

<span class="token comment"># Docker容器使用原则：不要在容器里面保存业务数据！！！</span>
<span class="token comment"># 要把业务数据保存到宿主机中，使用的技术是目录映射</span>

<span class="token comment"># pxc无法使用映射目录，可以采用docker卷来处理</span>

<span class="token comment"># 容器中的pxc节点映射数据目录的解决办法</span>
docker volume create --name v1    <span class="token comment"># --name可省略</span>

<span class="token comment"># 查看数据卷在宿主机的真实路径</span>
docker inspect v1

<span class="token comment"># 删除数据卷</span>
docker volume <span class="token function">rm</span> v1

<span class="token comment">#######################分割线##################################</span>

<span class="token comment"># 向pxc镜像传入运行参数创建pxc容器</span>
docker run -d -p 3307:3306 -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>yiyun2018 -e CLUSTER_NAME<span class="token operator">=</span>PXC -e XTRABACKUP_PASSWORD<span class="token operator">=</span>yiyun2018 -v v1:/var/lib/mysql --privileged --name<span class="token operator">=</span>node1 --net<span class="token operator">=</span>net1 --ip 172.18.0.2 pxc

<span class="token comment"># 创建第二个容器</span>
docker run -d -p 3308:3306 -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>yiyun2018 -e CLUSTER_NAME<span class="token operator">=</span>PXC -e XTRABACKUP_PASSWORD<span class="token operator">=</span>yiyun2018 -e CLUSTER_JOIN<span class="token operator">=</span>node1 -v v2:/var/lib/mysql --privileged --name<span class="token operator">=</span>node2 --net<span class="token operator">=</span>net1 --ip 172.18.0.3 pxc

<span class="token comment"># 创建第三个容器</span>
docker run -d -p 3309:3306 -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>yiyun2018 -e CLUSTER_NAME<span class="token operator">=</span>PXC -e XTRABACKUP_PASSWORD<span class="token operator">=</span>yiyun2018 -e CLUSTER_JOIN<span class="token operator">=</span>node1 -v v3:/var/lib/mysql --privileged --name<span class="token operator">=</span>node3 --net<span class="token operator">=</span>net1 --ip 172.18.0.4 pxc

<span class="token comment"># 创建第四个容器</span>
docker run -d -p 3310:3306 -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>yiyun2018 -e CLUSTER_NAME<span class="token operator">=</span>PXC -e XTRABACKUP_PASSWORD<span class="token operator">=</span>yiyun2018 -e CLUSTER_JOIN<span class="token operator">=</span>node1 -v v4:/var/lib/mysql --privileged --name<span class="token operator">=</span>node4 --net<span class="token operator">=</span>net1 --ip 172.18.0.5 pxc

<span class="token comment"># 创建第五个容器</span>
docker run -d -p 3311:3306 -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>yiyun2018 -e CLUSTER_NAME<span class="token operator">=</span>PXC -e XTRABACKUP_PASSWORD<span class="token operator">=</span>yiyun2018 -e CLUSTER_JOIN<span class="token operator">=</span>node1 -v v5:/var/lib/mysql --privileged --name<span class="token operator">=</span>node5 --net<span class="token operator">=</span>net1 --ip 172.18.0.6 pxc

<span class="token comment"># -d 后台运行</span>
<span class="token comment"># -p [宿主机端口]:[容器端口]  把容器的3306端口映射到宿主机的3306端口</span>
<span class="token comment"># -v v1:/var/lib/mysql 路径映射，/var/lib/mysql 容器内的目录</span>
<span class="token comment"># -e MYSQL_ROOT_PASSWORD  参数，创建出的数据库实例的密码（用户名是root，不可修改）</span>
<span class="token comment"># -e MYSQL_ROOT_PASSWORD  参数，创建出的pxc集群的名字</span>
<span class="token comment"># -e MYSQL_ROOT_PASSWORD  参数，数据库节点之间同步使用的密码</span>
<span class="token comment"># -e CLUSTER_JOIN  参数，和第一个节点容器进行同步</span>








</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">3/7/2019, 8:11:02 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/mysql/foreign-key.html" class="prev">
          外键设置
        </a></span> <span class="next"><a href="/mac/basic.html">
          Mac 资源库
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.0d7d7ae6.js" defer></script><script src="/assets/js/36.997b8f65.js" defer></script>
  </body>
</html>
