{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{181:function(s,t,a){\"use strict\";a.r(t);var e=a(0),n=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a(\"div\",{staticClass:\"content\"},[a(\"h1\",{attrs:{id:\"nginx-https服务\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#nginx-https服务\",\"aria-hidden\":\"true\"}},[s._v(\"#\")]),s._v(\" Nginx HTTPS服务\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"准备工作\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#准备工作\",\"aria-hidden\":\"true\"}},[s._v(\"#\")]),s._v(\" 准备工作\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[s._v(\"openssl version\\nnginx -V\\nrpm -qa \"),a(\"span\",{attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\" \"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"grep\")]),s._v(\" openssl\\n\")])])]),a(\"h2\",{attrs:{id:\"生成-key-csr-crt\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#生成-key-csr-crt\",\"aria-hidden\":\"true\"}},[s._v(\"#\")]),s._v(\" 生成 key,csr,crt\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[s._v(\"openssl genrsa -idea -out hostname.key 1024\\nopenssl req -new -key hostname.key -out docs.csr\\nopenssl -req -days 3650 -in docs.csr -signkey docs.key -out docs.crt\\n\")])])]),a(\"h2\",{attrs:{id:\"去掉-key-的密码\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#去掉-key-的密码\",\"aria-hidden\":\"true\"}},[s._v(\"#\")]),s._v(\" 去掉 key 的密码\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[s._v(\"openssl rsa -in ./hostname.key -out ./hostname_nopwd.key\\n\")])])]),a(\"h2\",{attrs:{id:\"直接通过-key-生成-crt\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#直接通过-key-生成-crt\",\"aria-hidden\":\"true\"}},[s._v(\"#\")]),s._v(\" 直接通过 key 生成 crt\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[s._v(\"openssl req -days 36500 -x509 -sha256 -nodes -newkey rsa:2048 -keyout hostname.key -out hostname.crt\\n\")])])]),a(\"h2\",{attrs:{id:\"nginx-的-https-的语法配置\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#nginx-的-https-的语法配置\",\"aria-hidden\":\"true\"}},[s._v(\"#\")]),s._v(\" Nginx 的 HTTPS 的语法配置\")]),s._v(\" \"),a(\"p\",[s._v(\"Syntax: ssl on | off;\\nDefault: ssl off;\\nContext: http, server\")]),s._v(\" \"),a(\"p\",[s._v(\"Syntax: ssl_centificate file;\\nDefault: --;\\nContext: http, server\")]),s._v(\" \"),a(\"p\",[s._v(\"Syntax: ssl_certificate_key file;\\nDefault: --;\\nContext: http, server\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"苹果证书要求\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#苹果证书要求\",\"aria-hidden\":\"true\"}},[s._v(\"#\")]),s._v(\" 苹果证书要求\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"服务器所有的连接使用 TLS1.2 以上的版本 (openssl 1.0.2)\")]),s._v(\" \"),a(\"li\",[s._v(\"HTTPS 证书必须使用 SHA256 以上哈希算法签名\")]),s._v(\" \"),a(\"li\",[s._v(\"HTTPS 证书必须使用 RSA 2048 位或 ECC 256 位以上的公钥算法\")]),s._v(\" \"),a(\"li\",[s._v(\"使用前向加密技术\")])]),s._v(\" \"),a(\"h2\",{attrs:{id:\"查看-crt-证书信息\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#查看-crt-证书信息\",\"aria-hidden\":\"true\"}},[s._v(\"#\")]),s._v(\" 查看 crt 证书信息\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[s._v(\"openssl x509 -noout -text -in ./hostname.crt\\n\")])])]),a(\"h2\",{attrs:{id:\"升级-openssl-脚本\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#升级-openssl-脚本\",\"aria-hidden\":\"true\"}},[s._v(\"#\")]),s._v(\" 升级 openssl 脚本\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[a(\"span\",{attrs:{class:\"token shebang important\"}},[s._v(\"#!/bin/sh\")]),s._v(\"\\n\"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"cd\")]),s._v(\" /opt/download\\n\"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"wget\")]),s._v(\" https://www.openssl.org/source/openssl-1.0.2k.tar.gz\\n\"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"tar\")]),s._v(\" -zxvf open-ssl-1.0.2k.tar.gz\\n\"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"cd\")]),s._v(\" openssl-1.0.2k\\n./confg --prefix\"),a(\"span\",{attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\"/usr/local/openssl\\n\"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"make\")]),s._v(\" \"),a(\"span\",{attrs:{class:\"token operator\"}},[s._v(\"&&\")]),s._v(\" \"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"make\")]),s._v(\" \"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\"\\n\"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"mv\")]),s._v(\" /usr/bin/openssl  /usr/bin/openssl.OFF\\n\"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"ln\")]),s._v(\" -s /usr/local/openssl/bin/openssl  /usr/bin/openssl\\n\"),a(\"span\",{attrs:{class:\"token function\"}},[s._v(\"ln\")]),s._v(\" -s /usr/local/openssl/include/openssl  /usr/include/openssl\\n\"),a(\"span\",{attrs:{class:\"token keyword\"}},[s._v(\"echo\")]),s._v(\" \"),a(\"span\",{attrs:{class:\"token string\"}},[s._v('\"/usr/local/openssl/lib\"')]),s._v(\" \"),a(\"span\",{attrs:{class:\"token operator\"}},[s._v(\">>\")]),s._v(\"/etc/ld.so.conf\\nldconfg -v\\nopenssl version -a\\n\")])])]),a(\"h2\",{attrs:{id:\"https-优化\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#https-优化\",\"aria-hidden\":\"true\"}},[s._v(\"#\")]),s._v(\" HTTPS 优化\")]),s._v(\" \"),a(\"p\",[s._v(\"https 连接建立 = tcp 握手 + ssl 握手\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"激活 keepalive 长连接\"),a(\"code\",[s._v(\"keepalive_timeout 100;\")])]),s._v(\" \"),a(\"li\",[s._v(\"设置 ssl session 缓存\\n\"),a(\"ul\",[a(\"li\",[a(\"code\",[s._v(\"ssl_session_cache shared:SSL:10m;\")])]),s._v(\" \"),a(\"li\",[a(\"code\",[s._v(\"ssl_session_timeout 10m;\")])])])])])])}],!1,null,null,null);n.options.__file=\"https.md\";t.default=n.exports}}]);","extractedComments":[]}