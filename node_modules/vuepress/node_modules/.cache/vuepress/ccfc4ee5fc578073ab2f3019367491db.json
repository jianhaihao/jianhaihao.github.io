{"remainingRequest":"/Users/jianhaihao/Documents/Products/jianhaihao.github.io/node_modules/vue-loader/lib/index.js??ref--1-1!/Users/jianhaihao/Documents/Products/jianhaihao.github.io/node_modules/vuepress/lib/webpack/markdownLoader.js??ref--1-2!/Users/jianhaihao/Documents/Products/jianhaihao.github.io/docs/nginx/https.md?vue&type=template&id=4c14a6ed&","dependencies":[{"path":"/Users/jianhaihao/Documents/Products/jianhaihao.github.io/docs/nginx/https.md","mtime":1537926977704},{"path":"/Users/jianhaihao/Documents/Products/jianhaihao.github.io/node_modules/cache-loader/dist/cjs.js","mtime":1537926978403},{"path":"/Users/jianhaihao/Documents/Products/jianhaihao.github.io/node_modules/vue-loader/lib/loaders/templateLoader.js","mtime":1537926981332},{"path":"/Users/jianhaihao/Documents/Products/jianhaihao.github.io/node_modules/cache-loader/dist/cjs.js","mtime":1537926978403},{"path":"/Users/jianhaihao/Documents/Products/jianhaihao.github.io/node_modules/vue-loader/lib/index.js","mtime":1537926981332},{"path":"/Users/jianhaihao/Documents/Products/jianhaihao.github.io/node_modules/vuepress/lib/webpack/markdownLoader.js","mtime":1537926981441}],"contextDependencies":[],"result":["\n<div class=\"content\"><h1 id=\"nginx-https服务\"><a class=\"header-anchor\" href=\"#nginx-https服务\" aria-hidden=\"true\">#</a> Nginx HTTPS服务</h1>\n<h2 id=\"准备工作\"><a class=\"header-anchor\" href=\"#准备工作\" aria-hidden=\"true\">#</a> 准备工作</h2>\n<!--beforebegin--><div class=\"language-bash extra-class\"><!--afterbegin--><pre v-pre class=\"language-bash\"><code>openssl version\nnginx -V\nrpm -qa <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> openssl\n</code></pre>\n<!--beforeend--></div><!--afterend--><h2 id=\"生成-key-csr-crt\"><a class=\"header-anchor\" href=\"#生成-key-csr-crt\" aria-hidden=\"true\">#</a> 生成 key,csr,crt</h2>\n<!--beforebegin--><div class=\"language-bash extra-class\"><!--afterbegin--><pre v-pre class=\"language-bash\"><code>openssl genrsa -idea -out hostname.key 1024\nopenssl req -new -key hostname.key -out docs.csr\nopenssl -req -days 3650 -in docs.csr -signkey docs.key -out docs.crt\n</code></pre>\n<!--beforeend--></div><!--afterend--><h2 id=\"去掉-key-的密码\"><a class=\"header-anchor\" href=\"#去掉-key-的密码\" aria-hidden=\"true\">#</a> 去掉 key 的密码</h2>\n<!--beforebegin--><div class=\"language-bash extra-class\"><!--afterbegin--><pre v-pre class=\"language-bash\"><code>openssl rsa -in ./hostname.key -out ./hostname_nopwd.key\n</code></pre>\n<!--beforeend--></div><!--afterend--><h2 id=\"直接通过-key-生成-crt\"><a class=\"header-anchor\" href=\"#直接通过-key-生成-crt\" aria-hidden=\"true\">#</a> 直接通过 key 生成 crt</h2>\n<!--beforebegin--><div class=\"language-bash extra-class\"><!--afterbegin--><pre v-pre class=\"language-bash\"><code>openssl req -days 36500 -x509 -sha256 -nodes -newkey rsa:2048 -keyout hostname.key -out hostname.crt\n</code></pre>\n<!--beforeend--></div><!--afterend--><h2 id=\"nginx-的-https-的语法配置\"><a class=\"header-anchor\" href=\"#nginx-的-https-的语法配置\" aria-hidden=\"true\">#</a> Nginx 的 HTTPS 的语法配置</h2>\n<p>Syntax: ssl on | off;\nDefault: ssl off;\nContext: http, server</p>\n<p>Syntax: ssl_centificate file;\nDefault: --;\nContext: http, server</p>\n<p>Syntax: ssl_certificate_key file;\nDefault: --;\nContext: http, server</p>\n<h2 id=\"苹果证书要求\"><a class=\"header-anchor\" href=\"#苹果证书要求\" aria-hidden=\"true\">#</a> 苹果证书要求</h2>\n<ul>\n<li>服务器所有的连接使用 TLS1.2 以上的版本 (openssl 1.0.2)</li>\n<li>HTTPS 证书必须使用 SHA256 以上哈希算法签名</li>\n<li>HTTPS 证书必须使用 RSA 2048 位或 ECC 256 位以上的公钥算法</li>\n<li>使用前向加密技术</li>\n</ul>\n<h2 id=\"查看-crt-证书信息\"><a class=\"header-anchor\" href=\"#查看-crt-证书信息\" aria-hidden=\"true\">#</a> 查看 crt 证书信息</h2>\n<!--beforebegin--><div class=\"language-bash extra-class\"><!--afterbegin--><pre v-pre class=\"language-bash\"><code>openssl x509 -noout -text -in ./hostname.crt\n</code></pre>\n<!--beforeend--></div><!--afterend--><h2 id=\"升级-openssl-脚本\"><a class=\"header-anchor\" href=\"#升级-openssl-脚本\" aria-hidden=\"true\">#</a> 升级 openssl 脚本</h2>\n<!--beforebegin--><div class=\"language-bash extra-class\"><!--afterbegin--><pre v-pre class=\"language-bash\"><code><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token function\">cd</span> /opt/download\n<span class=\"token function\">wget</span> https://www.openssl.org/source/openssl-1.0.2k.tar.gz\n<span class=\"token function\">tar</span> -zxvf open-ssl-1.0.2k.tar.gz\n<span class=\"token function\">cd</span> openssl-1.0.2k\n./confg --prefix<span class=\"token operator\">=</span>/usr/local/openssl\n<span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span>\n<span class=\"token function\">mv</span> /usr/bin/openssl  /usr/bin/openssl.OFF\n<span class=\"token function\">ln</span> -s /usr/local/openssl/bin/openssl  /usr/bin/openssl\n<span class=\"token function\">ln</span> -s /usr/local/openssl/include/openssl  /usr/include/openssl\n<span class=\"token keyword\">echo</span> <span class=\"token string\">\"/usr/local/openssl/lib\"</span> <span class=\"token operator\">>></span>/etc/ld.so.conf\nldconfg -v\nopenssl version -a\n</code></pre>\n<!--beforeend--></div><!--afterend--><h2 id=\"https-优化\"><a class=\"header-anchor\" href=\"#https-优化\" aria-hidden=\"true\">#</a> HTTPS 优化</h2>\n<p>https 连接建立 = tcp 握手 + ssl 握手</p>\n<ul>\n<li>激活 keepalive 长连接<code>keepalive_timeout 100;</code></li>\n<li>设置 ssl session 缓存\n<ul>\n<li><code>ssl_session_cache shared:SSL:10m;</code></li>\n<li><code>ssl_session_timeout 10m;</code></li>\n</ul>\n</li>\n</ul>\n</div>\n",null]}