{"remainingRequest":"D:\\Products\\jianhaihao.github.io\\node_modules\\vue-loader\\lib\\index.js??ref--1-1!D:\\Products\\jianhaihao.github.io\\node_modules\\vuepress\\lib\\webpack\\markdownLoader.js??ref--1-2!D:\\Products\\jianhaihao.github.io\\docs\\swoole\\tcp-server.md?vue&type=template&id=9e4fcafc&","dependencies":[{"path":"D:\\Products\\jianhaihao.github.io\\docs\\swoole\\tcp-server.md","mtime":1552405364555},{"path":"D:\\Products\\jianhaihao.github.io\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1552405366197},{"path":"D:\\Products\\jianhaihao.github.io\\node_modules\\vue-loader\\lib\\loaders\\templateLoader.js","mtime":1552405375424},{"path":"D:\\Products\\jianhaihao.github.io\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1552405366197},{"path":"D:\\Products\\jianhaihao.github.io\\node_modules\\vue-loader\\lib\\index.js","mtime":1552405375423},{"path":"D:\\Products\\jianhaihao.github.io\\node_modules\\vuepress\\lib\\webpack\\markdownLoader.js","mtime":1552405375700}],"contextDependencies":[],"result":["\n<div class=\"content\"><h1 id=\"tcp服务器\"><a class=\"header-anchor\" href=\"#tcp服务器\" aria-hidden=\"true\">#</a> TCP服务器</h1>\n<h2 id=\"服务端\"><a class=\"header-anchor\" href=\"#服务端\" aria-hidden=\"true\">#</a> 服务端</h2>\n<!--beforebegin--><div class=\"language-php extra-class\"><!--afterbegin--><pre v-pre class=\"language-php\"><code>\n<span class=\"token comment\">//创建Server对象，监听 127.0.0.1:9501端口</span>\n<span class=\"token variable\">$serv</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">swoole_server</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9501</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$serv</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token single-quoted-string string\">'work_num'</span>    <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// worker进程数 cpu 1-4</span>\n    <span class=\"token single-quoted-string string\">'max_request'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//监听连接进入事件</span>\n<span class=\"token comment\">/**\n * $fd 客户端连接的唯一标识\n * $reactor_id 线程ID\n */</span>\n<span class=\"token variable\">$serv</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'connect'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$serv</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$fd</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$reactor_id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token double-quoted-string string\">\"Client: <span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$reactor_id</span><span class=\"token punctuation\">}</span></span> - <span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">}</span></span> - Connect.\\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//监听数据接收事件</span>\n<span class=\"token variable\">$serv</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'receive'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$serv</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$fd</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$reactor_id</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$serv</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">,</span> <span class=\"token double-quoted-string string\">\"Server: <span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$reactor_id</span><span class=\"token punctuation\">}</span></span> - <span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">}</span></span> - \"</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$data</span> <span class=\"token punctuation\">.</span> <span class=\"token double-quoted-string string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//监听连接关闭事件</span>\n<span class=\"token variable\">$serv</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$serv</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$fd</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token double-quoted-string string\">\"Client: Close.\\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//启动服务器</span>\n<span class=\"token variable\">$serv</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n</code></pre>\n<!--beforeend--></div><!--afterend--><h2 id=\"客户端\"><a class=\"header-anchor\" href=\"#客户端\" aria-hidden=\"true\">#</a> 客户端</h2>\n<!--beforebegin--><div class=\"language-php extra-class\"><!--afterbegin--><pre v-pre class=\"language-php\"><code>\n<span class=\"token comment\">// 连接swoole tcp服务器</span>\n\n<span class=\"token variable\">$client</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">swoole_client</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SWOOLE_SOCK_TCP</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$client</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9501</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token double-quoted-string string\">\"连接失败\"</span><span class=\"token punctuation\">;</span>\n    exit<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// php cli常量</span>\n<span class=\"token function\">fwrite</span><span class=\"token punctuation\">(</span><span class=\"token constant\">STDOUT</span><span class=\"token punctuation\">,</span> <span class=\"token double-quoted-string string\">\"请输入消息：\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span><span class=\"token constant\">STDIN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 发送消息给 tcp server 服务器</span>\n<span class=\"token variable\">$client</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$msg</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 接受来自server的数据</span>\n<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$client</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">recv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token variable\">$result</span><span class=\"token punctuation\">;</span>\n\n</code></pre>\n<!--beforeend--></div><!--afterend--><h2 id=\"命令测试\"><a class=\"header-anchor\" href=\"#命令测试\" aria-hidden=\"true\">#</a> 命令测试</h2>\n<!--beforebegin--><div class=\"language-bash extra-class\"><!--afterbegin--><pre v-pre class=\"language-bash\"><code>\ntelnet 127.0.0.1 9501             <span class=\"token comment\"># 测试连接TCP服务器</span>\n\n</code></pre>\n<!--beforeend--></div><!--afterend--></div>\n",null]}