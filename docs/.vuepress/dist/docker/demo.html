<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker搭建应用 | YiYun</title>
    <meta name="description" content=" ">
    <link rel="icon" href="/avatar.jpeg">
    
    <link rel="preload" href="/assets/css/styles.610fe40a.css" as="style"><link rel="preload" href="/assets/js/app.610fe40a.js" as="script"><link rel="preload" href="/assets/js/7.b7fb8985.js" as="script"><link rel="prefetch" href="/assets/js/21.dde9f751.js"><link rel="prefetch" href="/assets/css/1.styles.5a8ea794.css"><link rel="prefetch" href="/assets/js/1.5a8ea794.js"><link rel="prefetch" href="/assets/css/2.styles.9d96225d.css"><link rel="prefetch" href="/assets/js/2.9d96225d.js"><link rel="prefetch" href="/assets/js/3.ab98f649.js"><link rel="prefetch" href="/assets/js/4.84517b1a.js"><link rel="prefetch" href="/assets/js/5.46b13929.js"><link rel="prefetch" href="/assets/js/6.107ada5f.js"><link rel="prefetch" href="/assets/js/8.e2bb77bf.js"><link rel="prefetch" href="/assets/js/9.831322de.js"><link rel="prefetch" href="/assets/js/10.1e7d13a3.js"><link rel="prefetch" href="/assets/js/11.2511acf0.js"><link rel="prefetch" href="/assets/js/12.84a1794b.js"><link rel="prefetch" href="/assets/js/13.6ae2e609.js"><link rel="prefetch" href="/assets/js/14.6e7015f5.js"><link rel="prefetch" href="/assets/js/15.ef7302d9.js"><link rel="prefetch" href="/assets/js/16.a51ceb74.js"><link rel="prefetch" href="/assets/js/17.3caf68da.js"><link rel="prefetch" href="/assets/js/18.e7f8fb71.js"><link rel="prefetch" href="/assets/js/19.3e6fe4cb.js"><link rel="prefetch" href="/assets/js/20.40b14d5c.js"><link rel="prefetch" href="/assets/js/22.1e4f12ca.js"><link rel="prefetch" href="/assets/js/23.b94de477.js"><link rel="prefetch" href="/assets/js/24.8a38c1f5.js"><link rel="prefetch" href="/assets/js/25.31e2a01b.js"><link rel="prefetch" href="/assets/js/26.f2cd0480.js"><link rel="prefetch" href="/assets/js/27.35c2040e.js"><link rel="prefetch" href="/assets/js/28.384d7cc9.js"><link rel="prefetch" href="/assets/js/29.560f867e.js"><link rel="prefetch" href="/assets/js/30.8b368920.js"><link rel="prefetch" href="/assets/js/31.c6c7a698.js"><link rel="prefetch" href="/assets/js/32.07c4991f.js"><link rel="prefetch" href="/assets/js/33.1f4ff58f.js"><link rel="prefetch" href="/assets/js/34.f0600a70.js"><link rel="prefetch" href="/assets/js/35.17563971.js"><link rel="prefetch" href="/assets/js/36.6cb4b6e1.js"><link rel="prefetch" href="/assets/js/37.bacc7728.js"><link rel="prefetch" href="/assets/js/38.9bd875e8.js"><link rel="prefetch" href="/assets/js/39.7c8cf26c.js"><link rel="prefetch" href="/assets/js/40.ca7ad48c.js"><link rel="prefetch" href="/assets/js/41.2efe417b.js"><link rel="prefetch" href="/assets/js/42.3b2b7c6b.js"><link rel="prefetch" href="/assets/js/43.ced915f1.js"><link rel="prefetch" href="/assets/js/44.3cee24ab.js"><link rel="prefetch" href="/assets/js/45.f7437996.js">
    <link rel="stylesheet" href="/assets/css/1.styles.5a8ea794.css"><link rel="stylesheet" href="/assets/css/2.styles.9d96225d.css"><link rel="stylesheet" href="/assets/css/styles.610fe40a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YiYun</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/swoft/basic.html" class="nav-link">Swoft</a></div><div class="nav-item"><a href="/yii/basic.html" class="nav-link">Yii2.0</a></div> <a href="https://github.com/jianhaihao/jianhaihao.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/swoft/basic.html" class="nav-link">Swoft</a></div><div class="nav-item"><a href="/yii/basic.html" class="nav-link">Yii2.0</a></div> <a href="https://github.com/jianhaihao/jianhaihao.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Mac</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Docker</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/docker/basic.html" class="sidebar-link">Docker 基础知识</a></li><li><a href="/docker/docker-compose.html" class="sidebar-link">docker-compose</a></li><li><a href="/docker/demo.html" class="active sidebar-link">Docker搭建应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docker/demo.html#centos-docker-安装" class="sidebar-link">CentOS Docker 安装</a></li><li class="sidebar-sub-header"><a href="/docker/demo.html#搭建php7和nginx运行环境" class="sidebar-link">搭建php7和nginx运行环境</a></li><li class="sidebar-sub-header"><a href="/docker/demo.html#安装mysql" class="sidebar-link">安装mysql</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ThinkPHP5</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Yii2.0</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Swoole</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Swoft基础</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Swoft进阶</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>MicroService</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Markdown</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>分布式服务架构</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="docker搭建应用"><a href="#docker搭建应用" aria-hidden="true" class="header-anchor">#</a> Docker搭建应用</h1> <h2 id="centos-docker-安装"><a href="#centos-docker-安装" aria-hidden="true" class="header-anchor">#</a> CentOS Docker 安装</h2> <h3 id="docker支持以下的centos版本："><a href="#docker支持以下的centos版本：" aria-hidden="true" class="header-anchor">#</a> Docker支持以下的CentOS版本：</h3> <p>CentOS 7 (64-bit)<br>
CentOS 6.5 (64-bit) 或更高的版本</p> <h3 id="前提条件"><a href="#前提条件" aria-hidden="true" class="header-anchor">#</a> 前提条件</h3> <p>目前，CentOS 仅发行版本中的内核支持 Docker。<br>
在CentOS 7 上，要求系统64位、内核版本为 3.10 以上。<br>
在CentOS-6.5 或更高的版本的 CentOS 上，要求系统为64位、内核版本为 2.6.32-431 或者更高版本。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 验证CentOS 版本是否支持 Docker</span>
<span class="token function">uname</span> -r    <span class="token comment"># 查看内核版本</span>
</code></pre></div><h3 id="安装docker"><a href="#安装docker" aria-hidden="true" class="header-anchor">#</a> 安装Docker</h3> <p>从 2017 年 3 月开始 docker 在原来的基础上分为两个分支版本: <code>Docker CE</code> 和 <code>Docker EE</code>。<br>
Docker CE 即社区免费版，Docker EE 即企业版，强调安全，但需付费使用。<br>
本文介绍 Docker CE 的安装使用。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>
<span class="token comment"># 使用 sudo 或 root 权限登录 Centos</span>

<span class="token function">sudo</span> yum update    <span class="token comment"># 确保yum包更新到最新</span>

<span class="token comment"># 执行 Docker 安装脚本</span>
<span class="token function">curl</span> -fsSL https://get.docker.com -o get-docker.sh
<span class="token function">sudo</span> sh get-docker.sh

<span class="token comment"># 启动Docker进程</span>
<span class="token function">sudo</span> systemctl start docker

<span class="token comment"># 验证docker是否安装成功并在容器中执行一个测试的镜像</span>
<span class="token function">sudo</span> docker run hello-world
docker images

<span class="token comment"># 镜像加速</span>
<span class="token function">vi</span> /etc/docker/daemon.json     <span class="token comment"># 如没有该文件，请先新建一个</span>

<span class="token comment"># 新建daemon.json文件</span>
<span class="token comment">###############################################################</span>
<span class="token function">cd</span> /etc/docker/
<span class="token function">touch</span> daemon.json
<span class="token comment">###############################################################</span>

<span class="token comment"># 文件内容</span>
<span class="token comment">###############################################################</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http://hub-mirror.c.163.com&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">###############################################################</span>

<span class="token comment"># 删除Docker CE</span>
<span class="token function">sudo</span> yum remove docker-ce
<span class="token function">sudo</span> <span class="token function">rm</span> -rf /var/lib/docker

</code></pre></div><h3 id="docker-使用"><a href="#docker-使用" aria-hidden="true" class="header-anchor">#</a> Docker 使用</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>
<span class="token comment">## Docker Hello World ##</span>

<span class="token comment"># Docker 允许你在容器内运行应用程序， 使用 docker run 命令来在容器内运行一个应用程序，输出Hello world</span>
docker run ubuntu:15.10 /bin/echo <span class="token string">&quot;Hello world&quot;</span>

<span class="token comment"># 各个参数解析：</span>
<span class="token comment"># docker: Docker 的二进制执行文件。</span>
<span class="token comment"># run:与前面的 docker 组合来运行一个容器。</span>
<span class="token comment"># ubuntu:15.10指定要运行的镜像，Docker首先从本地主机上查找镜像是否存在，如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像。</span>
<span class="token comment"># /bin/echo &quot;Hello world&quot;: 在启动的容器里执行的命令</span>
<span class="token comment"># 以上命令完整的意思为：Docker 以 ubuntu15.10 镜像创建一个新容器，然后在容器里执行 bin/echo &quot;Hello world&quot;，然后输出结果。</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 运行交互式的容器 ##</span>

<span class="token comment"># 通过docker的两个参数 -i -t，让docker运行的容器实现&quot;对话&quot;的能力</span>
docker run -i -t ubuntu:15.10 /bin/bash

<span class="token comment"># 各个参数解析：</span>
<span class="token comment"># -t:在新容器内指定一个伪终端或终端</span>
<span class="token comment"># -i:允许你对容器内的标准输入 (STDIN) 进行交互</span>
<span class="token comment"># 此时我们已进入一个 ubuntu15.10系统的容器</span>

<span class="token function">cat</span> /proc/version  <span class="token comment"># 查看当前系统的版本信息</span>
<span class="token function">ls</span>                 <span class="token comment"># 当前目录下的文件列表</span>

<span class="token comment"># 运行exit命令或者使用CTRL+D来退出容器。</span>

<span class="token comment">########################分割线#####################################</span>

<span class="token comment">## 启动容器（后台模式） ##</span>

<span class="token comment"># 创建一个以进程方式运行的容器</span>
docker run -d ubuntu:15.10 /bin/sh -c <span class="token string">&quot;while true; do echo hello world; sleep 1; done&quot;</span>
<span class="token comment"># 返回的一段字符串，为容器ID，可以通过容器ID来查看对应的容器发生了什么。</span>

docker <span class="token function">ps</span>     <span class="token comment"># 查看运行容器</span>

docker logs <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>  <span class="token comment"># 查看容器日志信息</span>

docker stop <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>  <span class="token comment"># 停止容器</span>

<span class="token comment">########################分割线#####################################</span>

</code></pre></div><h4 id="docker容器使用"><a href="#docker容器使用" aria-hidden="true" class="header-anchor">#</a> Docker容器使用</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>
<span class="token comment">## 运行一个web应用 ##</span>

docker pull training/webapp    <span class="token comment"># 载入镜像</span>

docker run -d -P training/webapp python app.py
<span class="token comment"># 参数说明:</span>
<span class="token comment"># -d:让容器在后台运行</span>
<span class="token comment"># -P:将容器内部使用的网络端口映射到我们使用的主机上</span>

docker <span class="token function">ps</span>   <span class="token comment"># 查看运行容器</span>
<span class="token comment"># 此时，可以看到端口信息</span>
PORTS
0.0.0.0:32769-<span class="token operator">&gt;</span>5000/tcp
<span class="token comment"># Docker 开放了 5000 端口（默认 Python Flask 端口）映射到主机端口 32769 上</span>

<span class="token comment"># 通过浏览器访问WEB应用</span>
192.168.217.10:32769

<span class="token comment"># 也可以通过 -p 参数来设置不一样的端口：</span>
docker run -d -p 5000:5000 training/webapp python app.py
<span class="token comment"># 容器内部的 5000 端口映射到我们本地主机的 5000 端口上。</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 网络端口的快捷方式 ##</span>
docker port <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>  <span class="token comment"># 查看容器端口的映射情况</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 查看 WEB 应用程序日志 ##</span>
docker logs <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>  <span class="token comment"># 查看容器内部的标准输出</span>

docker logs -f <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>   <span class="token comment"># 让 docker logs 像使用 tail -f 一样来输出容器内部的标准输出。</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 查看WEB应用程序容器的进程 ##</span>
docker <span class="token function">top</span> <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>  <span class="token comment"># 查看容器内部运行的进程</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 检查 WEB 应用程序 ##</span>
docker inspect <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>  <span class="token comment"># 查看 Docker 的底层信息</span>
<span class="token comment"># 返回一个 JSON 文件记录着 Docker 容器的配置和状态信息</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 停止 WEB 应用容器 ##</span>
docker stop <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>  <span class="token comment"># 停止容器</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 重启WEB应用容器 ##</span>
docker start <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>  <span class="token comment"># 已经停止的容器，使用 docker start 来启动</span>

docker <span class="token function">ps</span> -l        <span class="token comment"># 查询最后一次创建的容器  </span>

docker restart <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>  <span class="token comment"># 正在运行的容器，使用 docker restart 来重启</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 移除WEB应用容器 ##</span>
docker <span class="token function">rm</span> <span class="token punctuation">[</span>容器ID 或 容器名称<span class="token punctuation">]</span>  <span class="token comment"># 删除不需要的容器</span>
<span class="token comment"># 删除容器时，容器必须是停止状态，否则会报错</span>

<span class="token comment">########################分割线###################################</span>

</code></pre></div><h4 id="docker-镜像使用"><a href="#docker-镜像使用" aria-hidden="true" class="header-anchor">#</a> Docker 镜像使用</h4> <p>当运行容器时，使用的镜像如果在本地中不存在，docker 就会自动从 docker 镜像仓库中下载；<br>
默认是从 Docker Hub 公共镜像源下载。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>
<span class="token comment">## 列出镜像列表 ##</span>

docker images     <span class="token comment"># 列出本地主机上的镜像</span>

<span class="token comment"># 各个选项说明:</span>
<span class="token comment"># REPOSITORY：表示镜像的仓库源</span>
<span class="token comment"># TAG：镜像的标签</span>
<span class="token comment"># IMAGE ID：镜像ID</span>
<span class="token comment"># CREATED：镜像创建时间</span>
<span class="token comment"># SIZE：镜像大小</span>

<span class="token comment"># 同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本</span>
<span class="token comment"># 如ubuntu仓库源里，有15.10、14.04等多个不同的版本，可以使用 REPOSITORY:TAG 来定义不同的镜像。</span>

<span class="token comment"># 使用版本为15.10的ubuntu系统镜像来运行容器：</span>
docker run -t -i ubuntu:15.10 /bin/bash 
<span class="token comment"># 使用版本为14.04的ubuntu系统镜像来运行容器：</span>
docker run -t -i ubuntu:14.04 /bin/bash

<span class="token comment"># 如果不指定一个镜像的版本标签，默认使用latest镜像</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 获取一个新的镜像 ##</span>
docker pull <span class="token punctuation">[</span>镜像名称:镜像标签<span class="token punctuation">]</span>  <span class="token comment"># 获取新镜像</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 查找镜像 ##</span>
docker search <span class="token punctuation">[</span>待查找内容<span class="token punctuation">]</span>  <span class="token comment"># 查找镜像</span>

<span class="token comment"># NAME:镜像仓库源的名称</span>
<span class="token comment"># DESCRIPTION:镜像的描述</span>
<span class="token comment"># OFFICIAL:是否docker官方发布</span>
<span class="token comment"># 查找地址：https://hub.docker.com/</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment">## 创建镜像 ##</span>

<span class="token comment"># 当从docker镜像仓库中下载的镜像不能满足需求时，可以通过以下两种方式对镜像进行更改：</span>
<span class="token comment"># 1.从已经创建的容器中更新镜像，并且提交这个镜像</span>
<span class="token comment"># 2.使用 Dockerfile 指令来创建一个新的镜像</span>

<span class="token comment">########################分割线###################################</span>

</code></pre></div><h2 id="搭建php7和nginx运行环境"><a href="#搭建php7和nginx运行环境" aria-hidden="true" class="header-anchor">#</a> 搭建php7和nginx运行环境</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>
<span class="token comment"># 下载相关镜像</span>
docker pull nginx
docker pull php:7.2.12-fpm

<span class="token comment"># 建立相关目录</span>
<span class="token function">mkdir</span> -p /home/www
<span class="token function">mkdir</span> -p /home/nginx/conf.d

<span class="token comment"># 编辑default.conf</span>
vim /home/nginx/conf.d/default.conf
<span class="token comment">######################文件内容开始分割线###################################</span>
server <span class="token punctuation">{</span>
  listen  80 default_server<span class="token punctuation">;</span>
  server_name _<span class="token punctuation">;</span>
  root   /usr/share/nginx/html<span class="token punctuation">;</span>
 
  location / <span class="token punctuation">{</span>
   index index.html index.htm index.php<span class="token punctuation">;</span>
   autoindex off<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  location ~ \.php<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
   root   /var/www/html/<span class="token punctuation">;</span>
   fastcgi_pass 172.17.0.2:9000<span class="token punctuation">;</span>
   fastcgi_index index.php<span class="token punctuation">;</span>
   fastcgi_split_path_info ^<span class="token punctuation">((</span>?U<span class="token punctuation">)</span>.+\.php<span class="token punctuation">)</span><span class="token punctuation">(</span>/?.+<span class="token punctuation">)</span>$<span class="token punctuation">;</span>
   fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
   fastcgi_param PATH_INFO <span class="token variable">$fastcgi_path_info</span><span class="token punctuation">;</span>
   fastcgi_param PATH_TRANSLATED <span class="token variable">$document_root</span><span class="token variable">$fastcgi_path_info</span><span class="token punctuation">;</span>
   include  fastcgi_params<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">######################文件内容结束分割线###################################</span>

<span class="token comment"># 启动php环境</span>
docker run -p 9000:9000 --name php -v /home/www/:/var/www/html/ --privileged<span class="token operator">=</span>true --rm -d php:7.2.12-fpm

<span class="token comment"># 查看php镜像的ip地址</span>
docker inspect --format<span class="token operator">=</span><span class="token string">'{{.NetworkSettings.IPAddress}}'</span> php
172.17.0.2

<span class="token comment"># 修改default.conf配置文件，使fastcgi_pass的值为172.17.0.2:9000</span>
vim /home/nginx/conf.d/default.conf
fastcgi_pass 172.17.0.2:9000<span class="token punctuation">;</span>

<span class="token comment"># 启动nginx镜像</span>
docker run -p 80:80 --name nginx -v /home/www:/usr/share/nginx/html -v /home/nginx/conf.d:/etc/nginx/conf.d --privileged<span class="token operator">=</span>true --rm -d nginx

docker run -p 80:80 -p 443:443 --name nginxlog \
-v /usr/java/docker/nginxlog/log/:/var/log/nginx:rw \
-v /usr/java/docker/nginxlog/conf.d/:/etc/nginx/conf.d:rw \
-v /etc/letsencrypt:/etc/letsencrypt:rw \
-d nginx


<span class="token comment"># 查看镜像运行状态</span>
docker <span class="token function">ps</span>

<span class="token comment"># 生成php测试文件info.php</span>
<span class="token keyword">echo</span> <span class="token string">&quot;&lt;?php phpinfo();&quot;</span> <span class="token operator">&gt;</span> /home/www/info.php
<span class="token comment"># 浏览器访问 http://localhost/info.php 验证</span>

<span class="token comment">########################分割线###################################</span>

<span class="token comment"># nginx虚拟机配置</span>

<span class="token comment"># 以配置www.demo.com虚拟机为例,项目目录地址为/home/www/demo</span>
vim /home/nginx/conf.d/demo.conf
<span class="token comment">######################文件内容开始分割线###################################</span>
server <span class="token punctuation">{</span>
	listen  80<span class="token punctuation">;</span>
	server_name www.demo.com<span class="token punctuation">;</span>
	root   /usr/share/nginx/html/demo/<span class="token punctuation">;</span>

	location / <span class="token punctuation">{</span>
		index index.html index.htm index.php<span class="token punctuation">;</span>
		autoindex off<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>-e <span class="token variable">$request_filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			rewrite  ^<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$  /index.php?s<span class="token operator">=</span>/<span class="token variable">$1</span>  last<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	location ~ \.php<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
		root   /var/www/html/demo/<span class="token punctuation">;</span>
		fastcgi_pass 172.17.0.2:9000<span class="token punctuation">;</span>
		fastcgi_index index.php<span class="token punctuation">;</span>
		fastcgi_split_path_info ^<span class="token punctuation">((</span>?U<span class="token punctuation">)</span>.+\.php<span class="token punctuation">)</span><span class="token punctuation">(</span>/?.+<span class="token punctuation">)</span>$<span class="token punctuation">;</span>
		fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
		fastcgi_param PATH_INFO <span class="token variable">$fastcgi_path_info</span><span class="token punctuation">;</span>
		fastcgi_param PATH_TRANSLATED <span class="token variable">$document_root</span><span class="token variable">$fastcgi_path_info</span><span class="token punctuation">;</span>
		include  fastcgi_params<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">######################文件内容结束分割线###################################</span>
<span class="token comment"># 注意上述文件两处root的配置！！！</span>
<span class="token comment"># 因已指定宿主机的映射，这里 /usr/share/nginx/html 与 /var/www/html 目录实际就是宿主机的 /home/www </span>
<span class="token comment"># 但不可写为/home/www，否则会报File not found的错误，因为宿主机的配置是映射到容器目录的</span>


<span class="token comment">########################分割线###################################</span>

<span class="token comment"># 配置https</span>

<span class="token comment"># 建立https证书放置文件夹ssl</span>
<span class="token function">mkdir</span> -p /home/nginx/conf.d/ssl

<span class="token comment"># 放置https证书至宿主机/home/nginx/conf.d/ssl目录下</span>

<span class="token comment"># 配置虚拟机文件</span>
<span class="token comment"># 以配置www.demo.com虚拟机为例,项目目录地址为/home/www/demo</span>
<span class="token comment">######################文件内容开始分割线###################################</span>
server <span class="token punctuation">{</span>
    listen 80<span class="token punctuation">;</span>
    listen 443 ssl<span class="token punctuation">;</span>
    server_name www.demo.com<span class="token punctuation">;</span>
    root   /usr/share/nginx/html/demo/<span class="token punctuation">;</span>

    ssl_certificate  /etc/nginx/conf.d/ssl/1_www.demo.com_bundle.crt<span class="token punctuation">;</span>
    ssl_certificate_key  /etc/nginx/conf.d/ssl/2_www.demo.com.key<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
        index index.html index.htm index.php<span class="token punctuation">;</span>
        autoindex off<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>-e <span class="token variable">$request_filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            rewrite  ^<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$  /index.php?s<span class="token operator">=</span>/<span class="token variable">$1</span>  last<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    location ~ \.php<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
        root   /var/www/html/demo/<span class="token punctuation">;</span>
        fastcgi_pass 172.17.0.2:9000<span class="token punctuation">;</span>
        fastcgi_index index.php<span class="token punctuation">;</span>
        fastcgi_split_path_info ^<span class="token punctuation">((</span>?U<span class="token punctuation">)</span>.+\.php<span class="token punctuation">)</span><span class="token punctuation">(</span>/?.+<span class="token punctuation">)</span>$<span class="token punctuation">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
        fastcgi_param PATH_INFO <span class="token variable">$fastcgi_path_info</span><span class="token punctuation">;</span>
        fastcgi_param PATH_TRANSLATED <span class="token variable">$document_root</span><span class="token variable">$fastcgi_path_info</span><span class="token punctuation">;</span>
        include  fastcgi_params<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">######################文件内容结束分割线###################################</span>
<span class="token comment"># 注意上述文件两处root的配置！！！</span>
<span class="token comment"># 因已指定宿主机的映射，</span>
<span class="token comment"># /usr/share/nginx/html 与 /var/www/html 目录实际就是宿主机的 /home/www </span>
<span class="token comment"># /etc/nginx/conf.d 目录实际就是宿主机的 /home/nginx/conf.d</span>

<span class="token comment"># 配置http访问自动跳转至https</span>
<span class="token comment">######################文件内容开始分割线###################################</span>
server <span class="token punctuation">{</span>
    listen 80<span class="token punctuation">;</span>
    server_name www.demo.com<span class="token punctuation">;</span>
    <span class="token keyword">return</span> 301 https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    listen 443<span class="token punctuation">;</span>
    server_name www.demo.com<span class="token punctuation">;</span>
    root   /usr/share/nginx/html/demo/<span class="token punctuation">;</span>

    ssl on<span class="token punctuation">;</span>
    ssl_certificate  /etc/nginx/conf.d/ssl/1_www.demo.com_bundle.crt<span class="token punctuation">;</span>
    ssl_certificate_key  /etc/nginx/conf.d/ssl/2_www.demo.com.key<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
        index index.html index.htm index.php<span class="token punctuation">;</span>
        autoindex off<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>-e <span class="token variable">$request_filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            rewrite  ^<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$  /index.php?s<span class="token operator">=</span>/<span class="token variable">$1</span>  last<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    location ~ \.php<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
        root   /var/www/html/demo/<span class="token punctuation">;</span>
        fastcgi_pass 172.17.0.2:9000<span class="token punctuation">;</span>
        fastcgi_index index.php<span class="token punctuation">;</span>
        fastcgi_split_path_info ^<span class="token punctuation">((</span>?U<span class="token punctuation">)</span>.+\.php<span class="token punctuation">)</span><span class="token punctuation">(</span>/?.+<span class="token punctuation">)</span>$<span class="token punctuation">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
        fastcgi_param PATH_INFO <span class="token variable">$fastcgi_path_info</span><span class="token punctuation">;</span>
        fastcgi_param PATH_TRANSLATED <span class="token variable">$document_root</span><span class="token variable">$fastcgi_path_info</span><span class="token punctuation">;</span>
        include  fastcgi_params<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">######################文件内容结束分割线###################################</span>

</code></pre></div><h2 id="安装mysql"><a href="#安装mysql" aria-hidden="true" class="header-anchor">#</a> 安装mysql</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>
docker pull mysql:5.6

docker run -p 3306:3306 --name mysql -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/logs:/logs -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>123456 --rm -d mysql:5.6

<span class="token comment"># 如外网连不上数据库，执行以下处理：</span>
<span class="token comment">######################开始分割线###################################</span>
<span class="token comment"># 进入MySQL容器</span>
docker <span class="token function">exec</span> -it mysql /bin/bash

<span class="token comment"># 进入MySQL</span>
mysql -uroot -p

<span class="token comment"># 切换到mysql数据表</span>
use mysql

<span class="token comment"># 设置root帐号的密码</span>
update user <span class="token keyword">set</span> authentication_string <span class="token operator">=</span> password<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span> where user <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span>

<span class="token comment"># 对root进行授权</span>
GRANT ALL PRIVILEGES ON *.* TO <span class="token string">'root'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'root'</span> WITH GRANT OPTION<span class="token punctuation">;</span>
<span class="token comment">######################结束分割线###################################</span>

</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docker/docker-compose.html" class="prev">
          docker-compose
        </a></span> <span class="next"><a href="/php/install.html">
          PHP7 源码安装
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/7.b7fb8985.js" defer></script><script src="/assets/js/app.610fe40a.js" defer></script>
  </body>
</html>
